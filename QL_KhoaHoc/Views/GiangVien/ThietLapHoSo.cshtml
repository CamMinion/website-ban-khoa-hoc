@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model QL_KhoaHoc.Models.GiangVien

@{
    var listNganHang = BankList.GetBanks();
    ViewData["Title"] = "Thiết lập Hồ sơ Giảng viên";
    Layout = "~/Views/Shared/_GiangVien_Layout.cshtml";
}


<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-xl-10">

            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger">
                    <div asp-validation-summary="All" class="text-danger"></div>
                </div>
            }

            <div class="card shadow-lg border-0 rounded-lg">
                <div class="card-header bg-success text-white text-center">
                    <h3 class="fw-bold my-4"><i class="fas fa-graduation-cap me-2"></i> HOÀN THIỆN HỒ SƠ GIẢNG VIÊN</h3>
                    <p class="mb-0">Cung cấp đầy đủ thông tin để kích hoạt tài khoản và được cấp quyền tạo khóa học.</p>
                </div>
                <div class="card-body p-4 p-md-5">

                    @* --- [MỚI] PHẦN HIỂN THỊ TRẠNG THÁI HỒ SƠ --- *@
                    <div class="mb-4">
                        @if (string.IsNullOrEmpty(Model.TrangThaiHoSo) || Model.TrangThaiHoSo == "Chờ duyệt")
                        {
                            <div class="alert alert-warning border-start border-5 border-warning shadow-sm" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-hourglass-half fa-2x me-3 text-warning"></i>
                                    <div>
                                        <h5 class="alert-heading fw-bold mb-1">Đang chờ xét duyệt</h5>
                                        <p class="mb-0 small">Hồ sơ của bạn đang được Admin kiểm tra. Bạn vẫn có thể cập nhật lại thông tin trong lúc chờ.</p>
                                    </div>
                                </div>
                            </div>
                        }
                        else if (Model.TrangThaiHoSo == "Đã duyệt")
                        {
                            <div class="alert alert-success border-start border-5 border-success shadow-sm" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle fa-2x me-3 text-success"></i>
                                    <div>
                                        <h5 class="alert-heading fw-bold mb-1">Hồ sơ đã được duyệt</h5>
                                        <p class="mb-0 small">Tuyệt vời! Tài khoản giảng viên của bạn đã được xác minh. Bạn đã có thể nhận doanh thu.</p>
                                    </div>
                                </div>
                            </div>
                        }
                        else if (Model.TrangThaiHoSo == "Từ chối")
                        {
                            <div class="alert alert-danger border-start border-5 border-danger shadow-sm" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-exclamation-circle fa-2x me-3 text-danger"></i>
                                    <div>
                                        <h5 class="alert-heading fw-bold mb-1">Hồ sơ bị từ chối</h5>
                                        <p class="mb-0 small">Thông tin định danh hoặc ngân hàng không hợp lệ. Vui lòng kiểm tra và cập nhật lại.</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    @* ------------------------------------------------ *@
                    <form method="post" asp-action="LuuHoSoGiangVien" asp-controller="GiangVien" enctype="multipart/form-data">

                        <h4 class="mb-4 text-success border-bottom pb-2"><i class="fas fa-user-circle me-2"></i> Thông tin Hồ sơ Giảng viên</h4>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label asp-for="HoTen" class="form-label">Họ và Tên</label>
                                <input asp-for="HoTen" class="form-control" placeholder="Nguyễn Văn A" />
                                <span asp-validation-for="HoTen" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="ChucDanh" class="form-label">Chức Danh</label>
                                <input asp-for="ChucDanh" class="form-control" placeholder="Thạc sĩ, Kỹ sư, Chuyên gia..." />
                                <span asp-validation-for="ChucDanh" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label asp-for="TieuSu" class="form-label">Tiểu sử chi tiết</label>
                                <textarea asp-for="TieuSu" class="form-control" rows="4" placeholder="Giới thiệu về kinh nghiệm..."></textarea>
                                <span asp-validation-for="TieuSu" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Website" class="form-label">Website Cá nhân/Blog</label>
                                <input asp-for="Website" class="form-control" placeholder="https://websitecuaban.com" />
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Facebook" class="form-label">Facebook</label>
                                <input asp-for="Facebook" class="form-control" placeholder="https://facebook.com/..." />
                            </div>
                            <div class="col-md-6">
                                <label asp-for="LinkedIn" class="form-label">LinkedIn</label>
                                <input asp-for="LinkedIn" class="form-control" placeholder="https://linkedin.com/..." />
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Youtube" class="form-label">Youtube</label>
                                <input asp-for="Youtube" class="form-control" placeholder="https://youtube.com/..." />
                            </div>
                        </div>

                        <hr class="my-5">
                        <h4 class="mb-4 text-success border-bottom pb-2"><i class="fas fa-id-card me-2"></i> Định danh cá nhân (Bắt buộc để nhận tiền)</h4>

                        <div class="row g-3 mb-4">
                            @* <div class="col-md-6"> *@
                            @*     <label asp-for="MaSoThue" class="form-label">Mã số thuế cá nhân</label> *@
                            @*     <input asp-for="MaSoThue" class="form-control" placeholder="Nhập mã số thuế..." /> *@
                            @* </div> *@
                            <div class="col-md-6">
                            </div>

                           

                            <div class="col-md-6">
                                <label class="form-label">Ảnh CCCD (Mặt trước)</label>
                                <input asp-for="FileMatTruoc" class="form-control" type="file" accept="image/*"
                                       onchange="previewImage(this, 'preview-truoc')" /> <div class="mt-2 text-center">
                                    @if (!string.IsNullOrEmpty(Model.CCCD_MatTruoc))
                                    {
                                        <img id="preview-truoc" src="@Model.CCCD_MatTruoc" class="img-fluid rounded border shadow-sm" style="max-height: 200px;" alt="CCCD Mặt Trước" />
                                    }
                                    else
                                    {
                                        <img id="preview-truoc" src="#" class="img-fluid rounded border shadow-sm d-none" style="max-height: 200px;" alt="Preview" />
                                    }
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Ảnh CCCD (Mặt sau)</label>
                                <input asp-for="FileMatSau" class="form-control" type="file" accept="image/*"
                                       onchange="previewImage(this, 'preview-sau')" />

                                <div class="mt-2 text-center">
                                    @if (!string.IsNullOrEmpty(Model.CCCD_MatSau))
                                    {
                                        <img id="preview-sau" src="@Model.CCCD_MatSau" class="img-fluid rounded border shadow-sm" style="max-height: 200px;" alt="CCCD Mặt Sau" />
                                    }
                                    else
                                    {
                                        <img id="preview-sau" src="#" class="img-fluid rounded border shadow-sm d-none" style="max-height: 200px;" alt="Preview" />
                                    }
                                </div>
                            </div>

                           
                        </div>

                        <hr class="my-5">

                        <h4 class="mb-4 text-success border-bottom pb-2"><i class="fas fa-university me-2"></i> Thông tin Thanh toán</h4>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label asp-for="TenNH" class="form-label">Tên Ngân hàng</label>
                                <select asp-for="TenNH" class="form-select">
                                    <option value="">-- Chọn ngân hàng --</option>
                                    @foreach (var bank in listNganHang)
                                    {
                                        <option value="@bank">@bank</option>
                                    }
                                </select>
                                <span asp-validation-for="TenNH" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="STK" class="form-label">Số Tài khoản</label>
                                <input asp-for="STK" class="form-control" placeholder="Nhập số tài khoản (8-20 ký tự)" />
                                <span asp-validation-for="STK" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="TenChuThe" class="form-label">Tên Chủ Tài khoản</label>
                                <input asp-for="TenChuThe" class="form-control"
                                       placeholder="NGUYEN VAN A"
                                       id="inputTenChuThe"
                                       oninput="formatTenChuThe(this)" />
                                <span asp-validation-for="TenChuThe" class="text-danger"></span>
                                <small class="text-muted">Hệ thống sẽ tự động chuyển thành in hoa không dấu.</small>
                            </div>

                        </div>

                        <div class="d-grid mt-5">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-paper-plane me-2"></i> GỬI HỒ SƠ VÀ KÍCH HOẠT
                            </button>
                        </div>
                    </form>

                </div>
                <div class="card-footer text-center py-3 bg-light">
                    <p class="text-muted mb-0">Hồ sơ sẽ được lưu và bạn có thể chỉnh sửa sau này.</p>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}



    <script>
        function previewImage(input, imgId) {
            var preview = document.getElementById(imgId);
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('d-none'); // Hiện ảnh
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
                            }

<script>
    function formatTenChuThe(input) {
        // 1. Lấy giá trị
        let value = input.value;

        // 2. Chuyển thành Tiếng Việt không dấu
        value = removeVietnameseTones(value);

        // 3. Chuyển thành IN HOA
        value = value.toUpperCase();

        // 4. Gán lại vào ô input
        input.value = value;
    }

    // Hàm loại bỏ dấu Tiếng Việt chuẩn
    function removeVietnameseTones(str) {
        str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a");
        str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e");
        str = str.replace(/ì|í|ị|ỉ|ĩ/g, "i");
        str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o");
        str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u");
        str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y");
        str = str.replace(/đ/g, "d");
        str = str.replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g, "A");
        str = str.replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g, "E");
        str = str.replace(/Ì|Í|Ị|Ỉ|Ĩ/g, "I");
        str = str.replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g, "O");
        str = str.replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g, "U");
        str = str.replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g, "Y");
        str = str.replace(/Đ/g, "D");
        // Kết hợp nhiều dấu
        str = str.replace(/\u0300|\u0301|\u0303|\u0309|\u0323/g, "");
        return str;
    }
</script>